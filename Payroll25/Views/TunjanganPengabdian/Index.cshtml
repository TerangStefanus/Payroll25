@model TunjanganPengabdianModel.TunjanganViewModel

@section styles {
    <style>
        div.dataTables_wrapper div.dataTables_length, div.dataTables_wrapper div.dataTables_info {
            text-align: left;
        }

        table.table-bordered thead > tr > th {
            border: 1px solid black;
            background-color: #8fa0c7;
        }

        table.table-bordered tbody > tr > td {
            border: 1px solid;
            border-top: 0px;
        }

        .dataTables_length select {
            font-size: 15px;
        }

        table.table-bordered tbody > tr > td, table.table-bordered tbody > tr > td > input {
            vertical-align: middle;
            text-align: center;
            align-content: center;
            align-items: center;
        }
    </style>
}

<head>
    <meta name="viewport" content="width=device-width" />
    <title>Tunjangan Pengabdian</title>
    <!-- Referensi ke DataTables dan Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.2/css/jquery.dataTables.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <h1 class="my-4">Tunjangan Pengabdian</h1>

        <div class="border border-5 p-3 mb-4">
            <h3>Tambah Vakasi</h3>
            <!-- TODO -->
            <!-- Form tambah beban mengajar bisa ditambahkan di sini -->
        </div>

        <div class="border border-5" style="margin-bottom: 30px; padding: 10px">
            <div class="row">
                <div class="col-sm-6" style="margin-top: 20px;">
                    @using (Html.BeginForm("Create", "TunjanganPengabdian", FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()

                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        <div class="form-group" style="width: 670px; padding-left: 20px; padding-top: 10px;">
                            <label asp-for="TunjanganPengabdian.NPP" class="control-label"></label>
                            <input asp-for="TunjanganPengabdian.NPP" class="form-control" id="nppInput" />
                            <span asp-validation-for="TunjanganPengabdian.NPP" class="text-danger"></span>
                        </div>

                        <div class="form-group" style="width: 670px;padding-left: 20px;padding-top: 10px;">
                            <label asp-for="TunjanganPengabdian.ID_KOMPONEN_GAJI" class="control-label"></label>
                            <select asp-for="TunjanganPengabdian.ID_KOMPONEN_GAJI" class="form-control">
                                <option value="">Pilih Komponen Gaji</option>
                                @foreach (var komponenGaji in Model.TunjanganPengabdianList)
                                {
                                    <option value="@komponenGaji.ID_KOMPONEN_GAJI">@komponenGaji.ID_KOMPONEN_GAJI</option>
                                }
                            </select>
                            <span asp-validation-for="TunjanganPengabdian.ID_KOMPONEN_GAJI" class="text-danger"></span>
                        </div>

                        <div class="form-group row">
                            <div class="col-sm-6 mx-auto">
                                <label asp-for="TunjanganPengabdian.ID_BULAN_GAJI" class="control-label"></label>
                                <select asp-for="TunjanganPengabdian.ID_BULAN_GAJI" class="form-control" id="bulanGajiDropdown">
                                    <option value="">Pilih ID Bulan Gaji</option>
                                    @foreach (var bulanGaji in Model.TunjanganPengabdianList)
                                    {
                                        <option value="@bulanGaji.ID_BULAN_GAJI">@bulanGaji.ID_BULAN_GAJI</option>
                                    }
                                </select>
                                <span asp-validation-for="TunjanganPengabdian.ID_BULAN_GAJI" class="text-danger"></span>
                            </div>
                            <div class="col-sm-6 mx-auto">
                                <label class="control-label">Tahun</label>
                                <input type="number" class="form-control" id="tahunInput" />
                            </div>
                        </div>

                        <div class="form-group" style="width: 670px;padding-left: 20px;padding-top: 10px;">
                            <label asp-for="TunjanganPengabdian.JUMLAH" class="control-label"></label>
                            <input asp-for="TunjanganPengabdian.JUMLAH" class="form-control" />
                            <span asp-validation-for="TunjanganPengabdian.JUMLAH" class="text-danger"></span>
                        </div>

                        <div class="form-group" style="width: 670px;padding-left: 20px;padding-top: 10px;">
                            <label asp-for="TunjanganPengabdian.DESKRIPSI" class="control-label"></label>
                            <input asp-for="TunjanganPengabdian.DESKRIPSI" class="form-control" />
                            <span asp-validation-for="TunjanganPengabdian.DESKRIPSI" class="text-danger"></span>
                        </div>

                        <div class="form-group" style="width: 670px;padding-left: 20px;padding-top: 10px;">
                            <input type="submit" value="Create" class="btn btn-primary" />
                            <button type="button" class="btn btn-primary" onclick="getCariData()">Search</button>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="border border-5 p-3 mb-4">
            <h3>Cari Tunjangan Pengabdian</h3>
            <div class="row">
                <div class="col-sm-4">
                    <form id="searchForm" method="get" asp-action="Index" asp-controller="TunjanganPengabdian">
                        
                        <div class="form-group">
                            <label class="font-weight-bold">Fakultas:</label>
                            <select class="form-control" name="fakultas">
                                <option value="">Pilih Fakultas</option>
                                @if (Model.FakultasFilter == "teknologi_industri")
                                {
                                    <option value="teknologi_industri" selected>Teknologi Industri</option>
                                }
                                else
                                {
                                    <option value="teknologi_industri">Teknologi Industri</option>
                                }

                                @if (Model.FakultasFilter == "bisnis_ekonomika")
                                {
                                    <option value="bisnis_ekonomika" selected>Bisnis dan Ekonomika</option>
                                }
                                else
                                {
                                    <option value="bisnis_ekonomika">Bisnis dan Ekonomika</option>
                                }

                                @if (Model.FakultasFilter == "hukum")
                                {
                                    <option value="hukum" selected>Hukum</option>
                                }
                                else
                                {
                                    <option value="hukum">Hukum</option>
                                }

                                @if (Model.FakultasFilter == "teknobiologi")
                                {
                                    <option value="teknobiologi" selected>Teknobiologi</option>
                                }
                                else
                                {
                                    <option value="teknobiologi">Teknobiologi</option>
                                }

                                @if (Model.FakultasFilter == "teknik")
                                {
                                    <option value="teknik" selected>Teknik</option>
                                }
                                else
                                {
                                    <option value="teknik">Teknik</option>
                                }

                                @if (Model.FakultasFilter == "ilmu_sosial_dan_politik")
                                {
                                    <option value="ilmu_sosial_dan_politik" selected>Ilmu Sosial dan Politik</option>
                                }
                                else
                                {
                                    <option value="ilmu_sosial_dan_politik">Ilmu Sosial dan Politik</option>
                                }

                                @if (Model.FakultasFilter == "program_pascasarjana")
                                {
                                    <option value="program_pascasarjana" selected>Program Pascasarjana</option>
                                }
                                else
                                {
                                    <option value="program_pascasarjana">Program Pascasarjana</option>
                                }
                            </select>
                        </div>


                        <div class="form-group">
                            <label class="font-weight-bold">Prodi:</label>
                            <input type="text" class="form-control" name="prodi" value="@Model.ProdiFilter">
                        </div>
                        <div class="form-group">
                            <label class="font-weight-bold">Nama Mata Kuliah:</label>
                            <input type="text" class="form-control" name="namaMK" value="@Model.NamaMKFilter">
                        </div>
                        <button type="button" class="btn btn-primary" id="showButton">Show</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Tabel data beban mengajar -->
        <table class="table" id="dataTable">
            <thead style="background-color: #8FA0C7">
                <tr>
                    <th>NPP</th>
                    <th>SKS</th>
                    <th>NAMA MATAKULIAH</th>
                    <th>KELAS</th>
                    <th>JUMLAH HADIR</th>
                    <th>TGL BUAT</th>
                    <th>KODE UNIT</th>
                    <th>BUTTON</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.TunjanganPengabdianList.Count(); i++)
                {
                    var tunjanganPengabdian = Model.TunjanganPengabdianList.ElementAt(i);
                    <tr>
                        <td>@tunjanganPengabdian.NPP</td>
                        <td>@tunjanganPengabdian.SKS</td>
                        <td>@tunjanganPengabdian.NAMA_MK</td>
                        <td>@tunjanganPengabdian.KELAS</td>
                        <td>@tunjanganPengabdian.Jml_Hadir</td>
                        <td>@tunjanganPengabdian.Tgl_buat</td>
                        <td>@tunjanganPengabdian.Kode_Unit</td>
                        <td>
                            <div class="d-flex">
                                <button type="button" class="btn btn-secondary mr-2" data-toggle="modal" data-target="#editModal-@(tunjanganPengabdian.NPP)" id="editButton-@(tunjanganPengabdian.NPP)">Edit</button>
                                <button type="button" class="btn btn-secondary mr-2" data-toggle="modal" data-target="#deleteModal-@(tunjanganPengabdian.NPP)" id="deleteButton-@(tunjanganPengabdian.NPP)">Delete</button>
                                <button type="button" class="btn btn-secondary mr-2" data-toggle="modal" data-target="#detailModal-@(tunjanganPengabdian.NPP)" id="detailButton-@(tunjanganPengabdian.NPP)">Detail</button>
                            </div>
                        </td>
                    </tr>

                    <!-- TODO -->
                    <!-- Modal Edit/Update bisa ditambahkan di sini -->

                    <!-- TODO -->
                    <!-- Modal Delete bisa ditambahkan di sini -->
                }
            </tbody>
        </table>
    </div>
</body>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.2/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    <script>
        $(document).ready(function () {
            $('#dataTable').DataTable();
            $('#showButton').click(function () {
                $('#searchForm').submit();
            });
        });

        document.getElementById('showButton').addEventListener('click', function () {
            var tbody = document.getElementById('dataTable').querySelector('tbody');
            if (tbody.style.display === 'none') {
                tbody.style.display = 'table-row-group';
            } else {
                tbody.style.display = 'none';
            }
        });

        function getCariData() {
            var npp = $("#nppInput").val();
            var tahun = $("#tahunInput").val();

            $.get("/TunjanganPengabdian/GetKomponenGajiDropdown", { npp: npp }, function (data) {
                var options = "<option value=''>Pilih Komponen Gaji</option>";
                for (var i = 0; i < data.length; i++) {
                    options += "<option value='" + data[i].id + "'>" + data[i].id + "</option>";
                }
                $("#TunjanganPengabdian_ID_KOMPONEN_GAJI").html(options);
            });

            $.get("/TunjanganPengabdian/GetBulanGajiDropdown", { tahun: tahun }, function (data) {
                var options = "<option value=''>Pilih ID Bulan Gaji</option>";
                for (var i = 0; i < data.length; i++) {
                    options += "<option value='" + data[i].id_bulan + "'>" + data[i].id_bulan + "</option>";
                }
                $("#bulanGajiDropdown").html(options);
            });
        }


    </script>
}
